# 機能要件書

**プロジェクト名**: AI/システム開発特化型相見積もりサイト
**バージョン**: 1.0.0
**作成日**: 2025-10-15
**最終更新**: 2025-10-15

---

## 1. 機能要件概要

### 1.1 システム構成

```
┌─────────────────────────────────────────────────────┐
│                  フロントエンド                      │
│              Next.js + TypeScript                   │
│              Tailwind CSS + shadcn/ui               │
└──────────────────┬──────────────────────────────────┘
                   │ REST API / GraphQL
┌──────────────────┴──────────────────────────────────┐
│                  バックエンド                        │
│              Next.js API Routes                     │
│              Prisma ORM                             │
└──────────────────┬──────────────────────────────────┘
                   │
┌──────────────────┴──────────────────────────────────┐
│              Neon PostgreSQL                        │
│              (データベース)                          │
└─────────────────────────────────────────────────────┘
┌─────────────────────────────────────────────────────┐
│          Firebase Auth / Supabase Auth              │
│              (認証・認可)                            │
└─────────────────────────────────────────────────────┘
```

### 1.2 主要機能一覧

| カテゴリ | 機能 | 優先度 |
|---------|------|--------|
| **認証・ユーザー管理** | ユーザー登録・ログイン | P0 |
| | 企業登録・審査 | P0 |
| | プロフィール管理 | P1 |
| **企業検索・閲覧** | 企業一覧表示 | P0 |
| | 詳細検索・フィルター | P0 |
| | 企業詳細ページ | P0 |
| **資料請求** | 一括資料請求 | P0 |
| | 資料請求履歴 | P1 |
| | ステータス管理 | P1 |
| **企業管理** | リード管理ダッシュボード | P0 |
| | 企業ページ編集 | P0 |
| | 分析レポート | P1 |
| **マッチング** | AIレコメンデーション | P1 |
| | マッチングスコア | P2 |
| **レビュー・評価** | レビュー投稿 | P1 |
| | 評価集計 | P1 |
| **管理者機能** | 企業審査 | P0 |
| | ユーザー管理 | P1 |
| | システム設定 | P2 |

---

## 2. 認証・ユーザー管理

### 2.1 ユーザー登録（一般ユーザー）

#### 機能ID: AUTH-001

**概要**: 一般ユーザー（発注者）がアカウントを作成する

**ユーザーストーリー**:
> As a 発注検討者
> I want to アカウントを作成
> So that 資料請求やマイページ機能を利用できる

**入力**:
- メールアドレス（必須）
- パスワード（必須、8文字以上）
- 氏名（必須）
- 会社名（任意）
- 役職（任意）
- 電話番号（任意）

**処理**:
1. 入力バリデーション（Zod）
2. メールアドレス重複チェック
3. パスワードハッシュ化（Firebase Auth）
4. ユーザーレコード作成（DB）
5. 確認メール送信

**出力**:
- ユーザーID
- アクセストークン（JWT）
- リフレッシュトークン

**画面遷移**:
```
登録フォーム → メール確認画面 → （メールリンククリック） → ログイン完了 → トップページ
```

**バリデーションルール**:
| 項目 | ルール |
|------|--------|
| メールアドレス | RFC 5322準拠、重複不可 |
| パスワード | 8-64文字、英数字記号含む |
| 氏名 | 1-50文字 |
| 会社名 | 1-100文字 |
| 電話番号 | 10-11桁（ハイフンなし） |

**エラーハンドリング**:
- メールアドレス重複: "このメールアドレスは既に登録されています"
- パスワード脆弱: "パスワードは8文字以上、英数字を含めてください"
- ネットワークエラー: "通信エラーが発生しました。時間をおいて再度お試しください"

**セキュリティ要件**:
- [ ] パスワードはbcryptでハッシュ化（コスト係数12）
- [ ] CSRF保護（トークン検証）
- [ ] レートリミット（同一IPから1時間に5回まで）
- [ ] メール確認必須（未確認では一部機能制限）

### 2.2 企業登録（企業ユーザー）

#### 機能ID: AUTH-002

**概要**: 企業（サービス提供者）がアカウントを作成し、審査を受ける

**ユーザーストーリー**:
> As a 開発会社担当者
> I want to 企業アカウントを登録
> So that リード獲得・商談機会を増やせる

**入力**:
- **基本情報**
  - 企業名（必須）
  - 代表者名（必須）
  - 設立年月日（必須）
  - 資本金（必須）
  - 従業員数（必須）
  - 所在地（必須）
  - 電話番号（必須）
  - ウェブサイトURL（必須）
- **担当者情報**
  - 氏名（必須）
  - 役職（必須）
  - メールアドレス（必須）
  - パスワード（必須）
- **事業内容**
  - 事業概要（必須、500文字以内）
  - 主要技術スタック（複数選択可）
  - 得意領域（複数選択可）
  - 過去実績件数（必須）
- **証明書類**
  - 登記簿謄本（PDF、必須）
  - 会社案内資料（PDF、任意）

**処理**:
1. 入力バリデーション
2. 重複チェック（企業名・代表者メール）
3. 書類アップロード（Vercel Blob/S3）
4. 審査待ちステータスで登録
5. 管理者に審査依頼通知
6. 登録完了メール送信（審査待ち通知）

**出力**:
- 企業ID
- 審査ステータス: "pending"
- 登録完了メール

**審査フロー**:
```
企業登録 → 書類提出 → 管理者審査（2-3営業日）
            ↓
         審査結果通知
            ↓
    ┌──────┴──────┐
承認済み          非承認
    ↓              ↓
企業ページ公開   理由通知・再提出促進
```

**審査基準**:
- [ ] 登記簿謄本の確認（実在企業）
- [ ] ウェブサイト存在確認
- [ ] 事業内容が本サービス対象範囲
- [ ] 反社チェック（可能な範囲）

**エラーハンドリング**:
- 企業名重複: "この企業名は既に登録されています"
- 書類サイズ超過: "ファイルサイズは10MB以下にしてください"
- 審査非承認: "審査基準を満たしませんでした。理由: [詳細]"

### 2.3 ログイン

#### 機能ID: AUTH-003

**概要**: 登録済みユーザーがログインする

**入力**:
- メールアドレス
- パスワード
- ログイン状態を保持（チェックボックス）

**処理**:
1. 入力バリデーション
2. Firebase Auth認証
3. セッション作成（JWT発行）
4. ユーザー情報取得（DB）
5. ログイン履歴記録

**出力**:
- アクセストークン（JWT、有効期限1時間）
- リフレッシュトークン（有効期限30日）
- ユーザー情報（ID、氏名、権限）

**セキュリティ要件**:
- [ ] レートリミット（同一IPから10分に5回まで）
- [ ] ログイン失敗5回でアカウントロック（15分）
- [ ] ログイン履歴記録（IP、デバイス、時刻）
- [ ] 異常アクセス検知（通常と異なるIPからのログイン時にメール通知）

---

## 3. 企業検索・閲覧

### 3.1 企業一覧表示

#### 機能ID: COMPANY-001

**概要**: 登録企業を一覧表示し、検索・フィルター可能

**ユーザーストーリー**:
> As a 発注検討者
> I want to 開発会社を一覧で閲覧
> So that 条件に合う企業を見つけられる

**表示項目（カード形式）**:
- 企業名
- ロゴ画像
- キャッチコピー（50文字）
- 主要技術スタック（3つまで）
- 評価スコア（5段階、★表示）
- レビュー件数
- 価格帯（¥¥¥¥で表示）
- 所在地（都道府県）
- 実績件数
- 「お気に入り」ボタン

**デフォルトソート**: 総合評価順（降順）

**フィルター機能**:

| カテゴリ | 選択肢 | 複数選択 |
|---------|--------|---------|
| 技術スタック | React, Vue, Angular, Next.js, TypeScript, Python, Go, Ruby, PHP, Java... | ✓ |
| 得意領域 | AI開発, Web開発, モバイル開発, SaaS, API開発, インフラ... | ✓ |
| 価格帯 | ¥-¥¥¥¥（4段階） | - |
| 所在地 | 都道府県（47選択肢） | ✓ |
| 従業員数 | 1-10名, 11-50名, 51-100名, 101-500名, 501名以上 | - |
| 評価 | ★4.5以上, ★4.0以上, ★3.5以上 | - |
| 実績 | 100件以上, 50件以上, 10件以上 | - |

**ソート機能**:
- 総合評価順（デフォルト）
- 評価件数順
- 実績件数順
- 価格が安い順
- 価格が高い順
- 新着順

**ページネーション**:
- 1ページ20件表示
- 無限スクロール or ページャー選択可能

**UI/UX要件**:
- [ ] レスポンシブ対応（PC: 4列、タブレット: 2列、スマホ: 1列）
- [ ] スケルトンローディング表示
- [ ] フィルター選択後、即座に結果更新（リアルタイム）
- [ ] 検索結果件数表示（"123件の企業が見つかりました"）
- [ ] フィルターリセットボタン

**パフォーマンス要件**:
- [ ] 初回表示: 1秒以内
- [ ] フィルター適用: 500ms以内
- [ ] ページ遷移: 300ms以内

### 3.2 企業詳細ページ

#### 機能ID: COMPANY-002

**概要**: 企業の詳細情報を表示

**URL**: `/companies/[slug]`

**表示セクション**:

#### ヘッダー
- 企業名
- ロゴ
- キャッチコピー
- 評価スコア + レビュー件数
- 「資料請求」ボタン（CTA）
- 「お気に入り」ボタン

#### タブ構成

**1. 概要**
- 事業内容
- 設立年
- 従業員数
- 資本金
- 所在地（地図表示）
- ウェブサイトリンク

**2. 技術・実績**
- 主要技術スタック（アイコン表示）
- 得意領域
- 過去実績件数
- 導入事例（3-5件、画像+説明）

**3. 料金プラン**
- 価格帯の目安
- プラン比較表（任意）
- 見積もり例

**4. レビュー**
- 総合評価
- 評価分布（★5: 50件、★4: 30件...）
- レビュー一覧（最新順 / 評価順）
- レビュー投稿（発注経験者のみ）

**5. よくある質問**
- FAQ（企業が自由に設定）

**UI/UX要件**:
- [ ] スティッキーヘッダー（CTA常に表示）
- [ ] タブ切り替え（ページリロードなし）
- [ ] OGP設定（SNSシェア最適化）
- [ ] パンくずリスト

**SEO要件**:
- [ ] 構造化データ（JSON-LD: Organization, Review）
- [ ] メタディスクリプション動的生成
- [ ] 正規URL（rel="canonical"）

---

## 4. 資料請求

### 4.1 一括資料請求

#### 機能ID: REQUEST-001

**概要**: 複数企業に一括で資料請求を送信

**ユーザーストーリー**:
> As a 発注検討者
> I want to 複数企業に一括で資料請求
> So that 効率的に比較検討できる

**入力フロー**:

**Step 1: 企業選択**
- 企業一覧 or 企業詳細から「資料請求カート」に追加
- カート上限: 5社まで
- 選択中の企業一覧表示（削除可能）

**Step 2: 要件入力**
- プロジェクト名（必須、100文字）
- プロジェクト概要（必須、500文字）
- 予算（選択式: ~¥100万, ~¥300万, ~¥500万, ~¥1,000万, ~¥3,000万, ¥3,000万以上）
- 希望納期（選択式: 1ヶ月以内, 3ヶ月以内, 6ヶ月以内, 未定）
- 技術スタック希望（複数選択可）
- その他要望（任意、1000文字）

**Step 3: 連絡先情報**
- 氏名（必須）
- 会社名（任意）
- メールアドレス（必須）
- 電話番号（必須）
- 希望連絡方法（メール / 電話 / どちらでも）

**Step 4: 確認画面**
- 入力内容一覧表示
- プライバシーポリシー同意（チェックボックス）
- 利用規約同意（チェックボックス）

**Step 5: 送信完了**
- 資料請求ID発行
- 完了メッセージ表示
- マイページへの導線

**処理**:
1. 入力バリデーション
2. スパムチェック（reCAPTCHA v3）
3. トランザクション開始
4. 資料請求レコード作成（DB）
5. 各企業へ通知メール送信
6. ユーザーへ確認メール送信
7. トランザクションコミット

**出力**:
- 資料請求ID
- 送信完了メール（ユーザー）
- 通知メール（企業 × 5社）

**通知内容（企業向け）**:
```
件名: 【新規資料請求】[プロジェクト名]

[企業名] 様

新しい資料請求が届きました。

---
プロジェクト名: [プロジェクト名]
概要: [概要]
予算: [予算]
希望納期: [納期]
---

発注者情報:
氏名: [氏名]
会社: [会社名]
メール: [メール]
電話: [電話番号]

詳細・対応はこちら:
[管理画面URL]
```

**UI/UX要件**:
- [ ] プログレスバー表示（Step 1/5）
- [ ] 入力内容の自動保存（localStorage）
- [ ] 前のステップに戻る機能
- [ ] 入力エラーのリアルタイム表示
- [ ] 送信完了時、アニメーション表示

**バリデーションルール**:
| 項目 | ルール |
|------|--------|
| プロジェクト名 | 1-100文字 |
| プロジェクト概要 | 10-500文字 |
| メールアドレス | RFC 5322準拠 |
| 電話番号 | 10-11桁（ハイフンなし） |

**セキュリティ要件**:
- [ ] reCAPTCHA v3（スコア0.5以上で通過）
- [ ] レートリミット（同一ユーザー1時間に3回まで）
- [ ] SQLインジェクション対策（Prisma ORM使用）
- [ ] XSS対策（入力サニタイズ）

### 4.2 資料請求履歴

#### 機能ID: REQUEST-002

**概要**: 過去の資料請求履歴を閲覧・管理

**表示項目（リスト形式）**:
- 資料請求ID
- プロジェクト名
- 送信日時
- 送信企業数
- ステータス（未対応 / 対応中 / 提案受領 / 商談中 / 契約済み / 見送り）
- アクション（詳細表示 / ステータス変更）

**詳細画面**:
- プロジェクト要件（入力内容）
- 送信企業一覧（各社の対応ステータス）
- 企業からの返信・提案（タイムライン表示）
- メッセージ機能（企業とのやりとり）

**ステータス遷移**:
```
未対応 → 対応中 → 提案受領 → 商談中 → 契約済み
                                    ↓
                                 見送り
```

**フィルター**:
- ステータス別
- 送信日期間
- 企業名

---

## 5. 企業管理（企業ユーザー向け）

### 5.1 リード管理ダッシュボード

#### 機能ID: COMPANY-MANAGE-001

**概要**: 受信した資料請求を一覧表示・管理

**ダッシュボードKPI**:
- 今月の資料請求件数
- 未対応件数（アラート表示）
- 商談化率（%）
- 平均対応時間

**リード一覧（テーブル形式）**:

| 列名 | 内容 |
|------|------|
| ID | リードID |
| 受信日時 | タイムスタンプ |
| プロジェクト名 | 件名 |
| 発注者 | 氏名・会社名 |
| 予算 | 価格帯 |
| 納期 | 希望納期 |
| ステータス | 未対応/対応中/提案済み/商談中/受注/失注 |
| 優先度 | 高/中/低（自動判定 or 手動設定） |
| アクション | 詳細/返信/ステータス変更 |

**ソート**:
- 受信日時（新しい順/古い順）
- 優先度順
- ステータス別

**フィルター**:
- ステータス
- 予算帯
- 納期
- 受信日期間

**アクション**:
- 一括ステータス変更
- CSV エクスポート
- CRM連携（Salesforce/HubSpot）

### 5.2 企業ページ編集

#### 機能ID: COMPANY-MANAGE-002

**概要**: 自社の企業ページを編集

**編集可能項目**:
- **基本情報**
  - 企業名（変更不可）
  - ロゴ画像（PNG/JPG、推奨サイズ: 500x500px）
  - キャッチコピー（50文字）
  - 事業概要（500文字）
- **技術情報**
  - 主要技術スタック（複数選択）
  - 得意領域（複数選択）
  - 過去実績件数
- **導入事例**
  - 事例タイトル（必須、50文字）
  - 概要（必須、200文字）
  - サムネイル画像（任意）
  - 詳細URL（任意）
- **料金情報**
  - 価格帯（選択式）
  - プラン一覧（任意）
- **FAQ**
  - 質問・回答ペア（最大10件）

**編集画面UI**:
- リアルタイムプレビュー
- WYSIWYGエディタ（マークダウン対応）
- 画像アップロード（ドラッグ&ドロップ）
- 保存ボタン（下書き / 公開）

**バリデーション**:
- [ ] 画像サイズ: 10MB以下
- [ ] 画像形式: PNG, JPG, WebP
- [ ] 文字数制限チェック

### 5.3 分析レポート

#### 機能ID: COMPANY-MANAGE-003

**概要**: リード獲得・商談の分析データを表示

**期間選択**: 今月 / 先月 / 過去3ヶ月 / 過去6ヶ月 / 過去1年 / カスタム

**KPI一覧**:
| 指標 | 説明 |
|------|------|
| リード獲得数 | 資料請求受信件数 |
| 商談化率 | 商談に進んだ割合 |
| 受注率 | 受注に至った割合 |
| 平均対応時間 | 初回返信までの時間 |
| プロフィール閲覧数 | 企業ページのPV |
| お気に入り追加数 | お気に入りされた回数 |

**グラフ表示**:
- リード獲得推移（折れ線グラフ）
- ステータス別内訳（円グラフ）
- 予算帯別分布（棒グラフ）
- 技術スタック別リード数（棒グラフ）

**競合ベンチマーク**:
- 同業他社の平均値と比較
- 業界ランキング表示

---

## 6. マッチング機能

### 6.1 AIレコメンデーション

#### 機能ID: MATCH-001

**概要**: ユーザーの要件に基づいて最適な企業を推薦

**入力**:
- プロジェクト要件（技術スタック、予算、納期等）
- ユーザーの閲覧履歴
- 過去の資料請求履歴

**処理**:
1. ユーザープロファイル作成
2. 企業特性ベクトル化
3. コサイン類似度計算
4. スコアリング（0-100点）
5. 上位10社を抽出

**出力**:
- レコメンド企業リスト
- マッチング理由（"○○の実績が豊富"、"予算に合致"）
- マッチングスコア（%表示）

**アルゴリズム**:
```
マッチングスコア =
  技術スタック一致度 × 0.3 +
  予算適合度 × 0.2 +
  納期実績 × 0.15 +
  評価スコア × 0.15 +
  過去の類似案件実績 × 0.2
```

**UI表示**:
- トップページに「おすすめの企業」セクション
- 企業一覧ページに「マッチング順」ソート
- 各企業カードに「マッチング○○%」バッジ表示

---

## 7. レビュー・評価

### 7.1 レビュー投稿

#### 機能ID: REVIEW-001

**概要**: 発注経験者が企業を評価・レビュー

**投稿条件**:
- ログイン済みユーザー
- 該当企業への発注実績あり（資料請求履歴で確認）
- 同一企業へのレビューは1回のみ

**入力項目**:
- 総合評価（★1-5）
- カテゴリ別評価（★1-5）
  - 技術力
  - コミュニケーション
  - 納期遵守
  - コストパフォーマンス
  - サポート体制
- タイトル（必須、50文字）
- レビュー本文（必須、50-1000文字）
- プロジェクト内容（任意、200文字）
- 匿名投稿（チェックボックス）

**処理**:
1. 投稿条件チェック
2. スパムフィルター（NGワード）
3. レビューレコード作成
4. 企業の平均評価更新
5. 企業へ通知メール送信

**出力**:
- レビューID
- 投稿完了メッセージ

**モデレーション**:
- 管理者による事後承認制（オプション）
- 不適切なレビューは削除可能
- 企業側から「返信」機能

### 7.2 評価集計

#### 機能ID: REVIEW-002

**概要**: 企業の評価を集計・表示

**集計項目**:
- 総合評価（平均★、小数点1桁）
- レビュー件数
- カテゴリ別評価平均
- 評価分布（★5: X件、★4: Y件...）

**表示場所**:
- 企業詳細ページ
- 企業一覧カード
- 検索結果

**更新タイミング**:
- リアルタイム（レビュー投稿時）
- キャッシュ: 1時間

---

## 8. 管理者機能

### 8.1 企業審査

#### 機能ID: ADMIN-001

**概要**: 新規企業登録を審査・承認

**審査画面**:
- 企業基本情報一覧
- 提出書類閲覧（PDF viewer）
- ウェブサイト確認リンク
- 審査メモ入力欄

**アクション**:
- 承認: ステータス → "approved"、企業ページ公開
- 非承認: 理由入力 → 企業へ通知メール
- 保留: 追加情報要求

**審査フロー**:
```
新規登録通知 → 管理者審査 → 承認/非承認
                    ↓
              企業へ通知
```

### 8.2 ユーザー管理

#### 機能ID: ADMIN-002

**概要**: ユーザー・企業アカウントを管理

**機能**:
- ユーザー一覧表示
- 検索・フィルター（氏名、メール、企業名）
- ステータス変更（有効/停止/削除）
- 権限変更（一般/企業/管理者）
- アクティビティログ閲覧

---

## 9. API仕様

### 9.1 REST API エンドポイント

| エンドポイント | メソッド | 説明 |
|--------------|---------|------|
| `/api/auth/register` | POST | ユーザー登録 |
| `/api/auth/login` | POST | ログイン |
| `/api/auth/logout` | POST | ログアウト |
| `/api/companies` | GET | 企業一覧取得 |
| `/api/companies/:id` | GET | 企業詳細取得 |
| `/api/requests` | POST | 資料請求作成 |
| `/api/requests/:id` | GET | 資料請求詳細 |
| `/api/reviews` | POST | レビュー投稿 |
| `/api/companies/:id/reviews` | GET | レビュー一覧 |

### 9.2 認証

**方式**: Bearer Token (JWT)

**ヘッダー**:
```
Authorization: Bearer <access_token>
```

**トークンリフレッシュ**:
```
POST /api/auth/refresh
Body: { refreshToken: "..." }
```

---

**このドキュメントは Issue #2 の要件に基づいて、Miyabi Autonomous Agent により自動生成されました。**

🤖 Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>

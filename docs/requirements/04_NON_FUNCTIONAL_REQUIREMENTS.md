# 非機能要件書

**プロジェクト名**: AI/システム開発特化型相見積もりサイト
**バージョン**: 1.0.0
**作成日**: 2025-10-15
**最終更新**: 2025-10-15

---

## 1. パフォーマンス要件

### 1.1 レスポンスタイム

| 操作 | 目標値 | 最大値 |
|------|--------|--------|
| ページ初回表示（FCP） | 1.0秒 | 1.8秒 |
| ページ完全表示（LCP） | 2.0秒 | 2.5秒 |
| インタラクション応答（FID） | 50ms | 100ms |
| 視覚的安定性（CLS） | 0.05 | 0.1 |
| API応答時間（P95） | 300ms | 500ms |
| データベースクエリ（P95） | 50ms | 100ms |

### 1.2 Core Web Vitals

**Lighthouse スコア目標**:
- Performance: 90点以上
- Accessibility: 90点以上
- Best Practices: 95点以上
- SEO: 100点

### 1.3 スケーラビリティ

| 指標 | 初期 | 1年後 | 3年後 |
|------|------|-------|-------|
| 同時接続ユーザー数 | 100 | 1,000 | 10,000 |
| 日間PV | 5,000 | 50,000 | 500,000 |
| 登録企業数 | 100 | 500 | 2,000 |
| 登録ユーザー数 | 500 | 10,000 | 100,000 |
| DB容量 | 1GB | 50GB | 500GB |

**スケーリング戦略**:
- Vercelの自動スケーリング活用
- Neon PostgreSQLのコネクションプーリング
- CDN利用（画像・静的アセット）
- Redis キャッシュ導入（フェーズ2）

---

## 2. 可用性要件

### 2.1 稼働率

| 環境 | 目標稼働率 | 許容ダウンタイム（月間） |
|------|-----------|----------------------|
| 本番環境 | 99.9% | 43分 |
| ステージング | 99.0% | 7時間 |

### 2.2 障害対応

**障害レベル定義**:

| レベル | 定義 | 対応時間 | 復旧時間 |
|--------|------|---------|---------|
| Sev.1 - Critical | 全サービス停止 | 5分以内 | 1時間以内 |
| Sev.2 - High | 主要機能停止 | 15分以内 | 4時間以内 |
| Sev.3 - Medium | 一部機能停止 | 1時間以内 | 24時間以内 |
| Sev.4 - Low | 軽微な不具合 | 1営業日以内 | 1週間以内 |

### 2.3 バックアップ

**データベース**:
- 自動バックアップ: 日次（Neon自動）
- 保持期間: 30日間
- リストア時間: 1時間以内
- RPO（目標復旧時点）: 24時間
- RTO（目標復旧時間）: 4時間

**ファイル（画像等）**:
- Vercel Blob / S3の冗長化
- リージョン間レプリケーション

---

## 3. セキュリティ要件

### 3.1 認証・認可

**認証方式**:
- Firebase Authentication
- JWT（JSON Web Token）
- OAuth 2.0対応（将来）

**パスワードポリシー**:
- 最小8文字、最大64文字
- 英字（大文字・小文字）、数字、記号を含む
- よくあるパスワード禁止（top 10,000）
- ハッシュ化: bcrypt（コスト係数12）

**セッション管理**:
- アクセストークン有効期限: 1時間
- リフレッシュトークン有効期限: 30日
- セッション固定攻撃対策
- CSRF トークン検証

### 3.2 データ保護

**個人情報保護法対応**:
- [ ] 利用目的の明示
- [ ] 本人同意取得
- [ ] 安全管理措置
- [ ] 第三者提供の制限
- [ ] 開示・訂正・削除要求対応

**暗号化**:
- 通信: TLS 1.3（HTTPS必須）
- パスワード: bcrypt
- DB保存: Neon暗号化ストレージ
- 機密情報: AES-256

**アクセス制御**:
- RBAC（ロールベースアクセス制御）
- 最小権限の原則
- 権限レベル: 一般ユーザー / 企業ユーザー / 管理者

### 3.3 脆弱性対策

**OWASP Top 10 対策**:
- [ ] SQLインジェクション: Prisma ORM使用
- [ ] XSS: 入力サニタイズ、CSP設定
- [ ] CSRF: トークン検証
- [ ] 認証の不備: Firebase Auth
- [ ] セキュリティ設定ミス: Vercel設定レビュー
- [ ] 機微なデータの露出: 環境変数管理
- [ ] アクセス制御の不備: RBAC実装
- [ ] 既知の脆弱性: Dependabot自動更新

**セキュリティヘッダー**:
```
Content-Security-Policy: default-src 'self'
X-Frame-Options: DENY
X-Content-Type-Options: nosniff
Strict-Transport-Security: max-age=31536000
Referrer-Policy: strict-origin-when-cross-origin
```

### 3.4 監査ログ

**記録対象**:
- ログイン/ログアウト
- パスワード変更
- 権限変更
- データ削除
- 管理者操作

**保持期間**: 1年間

---

## 4. ユーザビリティ要件

### 4.1 レスポンシブデザイン

**対応デバイス**:
- PC: 1920px - 1024px
- タブレット: 1024px - 768px
- スマートフォン: 768px - 320px

**ブレークポイント**:
```css
mobile: 640px
tablet: 768px
desktop: 1024px
wide: 1280px
```

### 4.2 ブラウザ対応

| ブラウザ | 最小バージョン |
|---------|--------------|
| Chrome | 最新 - 2バージョン |
| Firefox | 最新 - 2バージョン |
| Safari | 最新 - 2バージョン |
| Edge | 最新 - 2バージョン |

**非対応**: IE11以下

### 4.3 アクセシビリティ

**WCAG 2.1 レベルAA準拠**:
- [ ] キーボード操作対応
- [ ] スクリーンリーダー対応
- [ ] 色覚異常対応（コントラスト比4.5:1以上）
- [ ] テキストサイズ拡大対応（200%まで）
- [ ] ALT属性設定（画像）
- [ ] aria属性設定

**Lighthouse Accessibility スコア**: 90点以上

### 4.4 多言語対応

**初期リリース**:
- 日本語のみ

**将来対応**:
- 英語（フェーズ2）
- 中国語（フェーズ3）

**i18n実装**:
- next-i18next
- 言語切り替えUI
- URL構造: `/ja/`, `/en/`

---

## 5. 保守性要件

### 5.1 コード品質

**TypeScript**:
- strict mode有効
- ESLint設定（Airbnb スタイルガイド準拠）
- Prettier設定（自動フォーマット）

**テストカバレッジ**:
- 単体テスト: 80%以上
- 統合テスト: 主要フロー100%
- E2Eテスト: クリティカルパス100%

**コード規約**:
```
# ディレクトリ構造
src/
├── app/           # Next.js App Router
├── components/    # Reactコンポーネント
├── lib/           # ユーティリティ関数
├── hooks/         # カスタムフック
├── types/         # 型定義
├── styles/        # スタイルシート
└── tests/         # テストコード
```

### 5.2 ドキュメント

**必須ドキュメント**:
- [ ] README.md（セットアップ手順）
- [ ] CONTRIBUTING.md（コントリビュートガイド）
- [ ] API仕様書（OpenAPI 3.0）
- [ ] データベーススキーマ図
- [ ] デプロイ手順書
- [ ] 運用手順書

**コードドキュメント**:
- JSDoc コメント
- 関数・クラスの説明
- 複雑なロジックの解説

### 5.3 監視・ロギング

**監視ツール**:
- Vercel Analytics（パフォーマンス）
- Sentry（エラートラッキング）
- Google Analytics 4（アクセス解析）

**ログレベル**:
- ERROR: システムエラー、例外
- WARN: 警告、非推奨機能使用
- INFO: 一般的な情報
- DEBUG: デバッグ情報（本番では無効）

**アラート設定**:
- エラー率 > 1%: Slack通知
- API応答時間 > 1秒（P95）: メール通知
- 稼働率 < 99.9%: 電話通知

---

## 6. 互換性要件

### 6.1 データ移行

**将来の移行シナリオ**:
- 他社サービスからのデータインポート
- エクスポート機能（CSV/JSON）

**データフォーマット**:
- CSV: UTF-8 BOM付き
- JSON: RFC 8259準拠

### 6.2 API互換性

**バージョニング**:
- URL: `/api/v1/`, `/api/v2/`
- 後方互換性維持期間: 最低6ヶ月
- 非推奨APIの事前告知: 3ヶ月前

### 6.3 外部連携

**対応予定**:
- CRM連携（Salesforce, HubSpot）
- 会計ソフト連携（freee, マネーフォワード）
- コミュニケーションツール（Slack, Chatwork）

---

## 7. 法規制・コンプライアンス

### 7.1 個人情報保護法

**対応項目**:
- [ ] プライバシーポリシー公開
- [ ] 利用目的の明示・同意取得
- [ ] 安全管理措置（技術的・組織的）
- [ ] 第三者提供の記録・確認
- [ ] 開示請求対応プロセス
- [ ] 漏えい時の報告体制

### 7.2 電子消費者契約法

**対応項目**:
- [ ] 利用規約の明示
- [ ] 契約内容の確認画面
- [ ] 誤操作防止（確認画面）
- [ ] 契約内容の記録・保存

### 7.3 特定商取引法

**対応項目**（有料プラン提供時）:
- [ ] 運営者情報の表示
- [ ] 返品・キャンセルポリシー
- [ ] 料金表示（税込）

---

## 8. 運用要件

### 8.1 デプロイ

**デプロイ環境**:
- 開発環境: Vercel Preview
- ステージング環境: Vercel Production (staging)
- 本番環境: Vercel Production (main)

**デプロイフロー**:
```
feature ブランチ → develop → staging → main
    ↓               ↓          ↓        ↓
Preview         Preview    Staging   Production
```

**デプロイ頻度**:
- 開発環境: PR作成時
- ステージング: develop マージ時
- 本番: main マージ時（週1-2回）

**ロールバック**:
- Vercel 即座にロールバック可能（ボタン1クリック）
- DB migration: 手動ロールバックスクリプト

### 8.2 メンテナンス

**定期メンテナンス**:
- 頻度: 月1回（第3日曜 2:00-4:00）
- 事前告知: 1週間前

**緊急メンテナンス**:
- Sev.1障害時: 即座実施
- 事前告知: 可能な限り

---

## 9. パフォーマンス最適化戦略

### 9.1 フロントエンド最適化

**画像最適化**:
- Next.js Image コンポーネント使用
- WebP/AVIF フォーマット
- レスポンシブ画像（srcset）
- 遅延読み込み（lazy loading）

**コード分割**:
- ルートベース分割（Next.js自動）
- 動的インポート（React.lazy）
- Bundle分析（@next/bundle-analyzer）

**キャッシュ戦略**:
- 静的アセット: 1年（immutable）
- API レスポンス: 5分（stale-while-revalidate）
- ページ: ISR（Incremental Static Regeneration）

### 9.2 バックエンド最適化

**データベース最適化**:
- インデックス設定（検索頻度高いカラム）
- コネクションプーリング（Prisma）
- クエリ最適化（N+1問題回避）

**API最適化**:
- GraphQL導入（オーバーフェッチ削減）
- バッチ処理（DataLoader）
- レスポンス圧縮（gzip/brotli）

---

## 10. 災害復旧計画（DR）

### 10.1 バックアップ戦略

**自動バックアップ**:
- DB: 日次（Neon自動）
- ファイル: リージョン間レプリケーション

**手動バックアップ**:
- 主要リリース前
- DB migration 前

### 10.2 復旧手順

**RTO（目標復旧時間）**: 4時間
**RPO（目標復旧時点）**: 24時間

**復旧優先順位**:
1. 認証システム
2. 企業一覧・検索
3. 資料請求機能
4. 管理画面

---

**このドキュメントは Issue #2 の要件に基づいて、Miyabi Autonomous Agent により自動生成されました。**

🤖 Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>
